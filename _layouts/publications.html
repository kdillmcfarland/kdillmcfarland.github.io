---
layout: default
custom_css: true
---

<div class="content-container">
  <br>
{%- comment -%}
Get all tags
{%- endcomment -%}

{% assign all_tags = "" | split: "" %}

{% for section in site.data.publications %}
  {% for subsection in section.subsections %}
    {% for ref in subsection.references %}
      {% if ref.tags %}
        {% assign all_tags = all_tags | concat: ref.tags %}
      {% endif %}
    {% endfor %}
  {% endfor %}
{% endfor %}

{%- comment -%}
Count occurences
{%- endcomment -%}

{% assign tag_counts = "" | split: "" %}

{% for tag in all_tags %}
  {% assign tag_lc = tag | downcase %}
  {% assign found = false %}
  
  {% for i in (0..tag_counts.size) %}
    {% assign mod = i | modulo: 2 %}
    {% if mod == 0 %}
      {% assign current_tag = tag_counts[i] %}
      {% assign idx = i | plus: 1 %}
      {% assign current_count = tag_counts[idx] %}
      
      {% if current_tag == tag_lc %}
        {% assign new_count = current_count | plus: 1 %}
        {% assign before = tag_counts | slice: 0, i %}
        {% assign after = tag_counts | slice: idx | slice: 1, tag_counts.size %}
        {% assign tag_counts = before | push: current_tag | push: new_count | concat: after %}
        {% assign found = true %}
        {% break %}
      {% endif %}
    {% endif %}
  {% endfor %}
  
  {% unless found %}
    {% assign tag_counts = tag_counts | push: tag_lc | push: 1 %}
  {% endunless %}
{% endfor %}

{%- comment -%}
Order counts
{%- endcomment -%}

{% assign counts_copy = tag_counts %}
{% assign top_tags = "" | split: "" %}
{% assign top_counts = "" | split: "" %}

{% for iter in (1..5) %}
  {% if counts_copy.size == 0 %}
    {% break %}
  {% endif %}

  {% assign max_count = 0 %}
  {% assign max_tag = "" %}
  {% assign max_index = 0 %}

  {% for i in (0..counts_copy.size | minus: 2) %}
    {% assign mod = i | modulo: 2 %}
    {% if mod == 0 %}
      {% assign tag = counts_copy[i] %}
      {% assign idx = i | plus: 1 %}
      {% assign count = counts_copy[idx] %}
      {% if count > max_count %}
        {% assign max_count = count %}
        {% assign max_tag = tag %}
        {% assign max_index = i %}
      {% endif %}
    {% endif %}
  {% endfor %}

  {% assign top_tags = top_tags | push: max_tag %}
  {% assign top_counts = top_counts | push: max_count %}

  {% assign before = counts_copy | slice: 0, max_index %}
  {% assign after = counts_copy | slice: max_index | slice: 2, counts_copy.size %}
  {% assign counts_copy = before | concat: after %}
{% endfor %}

<p>All: {{ all_tags | join: ", " }}</p>
<p>Counts: {{ sorted_counts | join: ", " }}</p>

<div class="top-tags-box" style="margin-bottom: 1em;">
  <strong>Top Tags:</strong>
  <div class="top-tags">
    {% for tag in top_tags %}
      <span class="pub-tags top-tag" data-tag="{{ tag | downcase }}">{{ tag }}</span>
    {% endfor %}
  </div>
</div>
<br>
<br>

  <div id="filter-info" style="margin-bottom: 1em; display:none;">
  Filtered by tag: <span id="active-filter"></span>
  <br>
  <button id="clear-filter">Clear filter</button>
  </div>

  <div class="publications-container">

    {% for section in site.data.publications %}
      {% comment %} Reset counter for each section {% endcomment %}
      {% assign count = 0 %}

      <h3>{{ section.section }}</h3>

      {% for subsection in section.subsections %}
        {% if subsection.subsection %}
          <h4>{{ subsection.subsection }}</h4>
        {% endif %}

        {% for ref in subsection.references %}
          {% assign count = count | plus: 1 %}
        {% assign sorted_tags = ref.tags | sort %}
        <div class="publication-row" data-tags="{{ sorted_tags | join: '|' | downcase }}">
            
          <div class="references-column">
              <span class="ref-number">{{ count }}.</span>
              <span class="ref-text">{{ ref.text | markdownify }}</span>
          </div>
          
          <div class="pub-tags-column">
            {% for tag in sorted_tags %}
              <span class="pub-tags" data-tag="{{ tag | downcase }}">{{ tag }}</span>
            {% endfor %}
            </div>
            
        </div>
        {% endfor %}
      {% endfor %}
    {% endfor %}
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const publicationRows = document.querySelectorAll(".publication-row");
  const filterInfo = document.getElementById("filter-info");
  const activeFilter = document.getElementById("active-filter");
  const clearFilterBtn = document.getElementById("clear-filter");

  let selectedTags = [];

  function updateFilterDisplay() {
    if (selectedTags.length > 0) {
      activeFilter.textContent = selectedTags.join(", ");
      filterInfo.style.display = "block";
    } else {
      activeFilter.textContent = "";
      filterInfo.style.display = "none";
    }
  }

  function filterPublications() {
  if (selectedTags.length === 0) {
    publicationRows.forEach(row => row.style.display = "");
    return;
  }

  publicationRows.forEach(row => {
    const tags = row.getAttribute("data-tags").split("|");
    const matchesAny = selectedTags.some(tag => tags.includes(tag));
    row.style.display = matchesAny ? "" : "none";
  });
}

  function handleTagClick(tag) {
  tag = tag.toLowerCase();

  if (!selectedTags.includes(tag)) {
    selectedTags.push(tag);
  } else {
    selectedTags = selectedTags.filter(t => t !== tag);
  }

  updateFilterDisplay();
  filterPublications();

  // ðŸ”½ Add this to toggle selected class on all matching tags
  document.querySelectorAll(`.pub-tags[data-tag="${tag}"]`).forEach(el => {
    el.classList.toggle("selected");
  });
}


  function clearFilter() {
  selectedTags = [];
  updateFilterDisplay();

  publicationRows.forEach(row => row.style.display = "");

  // Remove visual selection from all tags
  document.querySelectorAll(".pub-tags.selected").forEach(el => {
    el.classList.remove("selected");
  });
}

  document.querySelectorAll(".pub-tags").forEach(tagEl => {
    tagEl.style.cursor = "pointer";
    tagEl.addEventListener("click", () => {
      const tag = tagEl.getAttribute("data-tag");
      handleTagClick(tag);
    });
  });

  clearFilterBtn.addEventListener("click", clearFilter);
});
</script>
